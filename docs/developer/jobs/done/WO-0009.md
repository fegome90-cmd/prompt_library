# WO-0009: Fix parsing de versi贸n con validaci贸n

## Metadatos
| Campo | Valor |
|-------|-------|
| id | WO-0009 |
| title | Fix parsing de versi贸n con validaci贸n |
| type | fix |
| priority | P2 |
| area | BE |
| status |  Pending |

## Rationale
Hallazgo BUG: Version parsing error. Si version es 'abc' o formato inv谩lido, parseInt falla silenciosamente y puede causar errores.

## Scope

### Include
- `src/app/api/prompts/[id]/route.ts`

### Exclude
- No modificar otros campos
- No cambiar otros endpoints

## Dependencies
Ninguna

## Acceptance Criteria
- [ ] PUT con version='abc' retorna 400 con error descriptivo
- [ ] PUT con version='1.2.3' funciona correctamente
- [ ] PUT con version='1' funciona correctamente (default a '1.1')

## Definition of Done

### Tests
- [ ] curl con version inv谩lido retorna 400

### Security
- N/A

### Observability
- [ ] console.warn cuando version tiene formato inv谩lido

### Docs
- [ ] Comentario explicando formato esperado

### Evidence
- [ ] curl commands mostrando validaci贸n
- [ ] Diff del cambio

## Verify

### Commands
```bash
# Test versi贸n inv谩lida (esto requiere mandar changelog para activar versioning)
curl -X PUT -H "Content-Type: application/json" -d '{"body":"new body","changelog":"test"}' http://localhost:3000/api/prompts/<ID>

# Lint
bun run lint
```

### Expected
- Versi贸n con formato inv谩lido retorna 400
- Lint pasa

## Risk

### Failure Modes
- Bloquear versiones leg铆timas con formato nuevo
- Regex muy restrictivo

### Rollback
```bash
git revert <commit-hash>
```

## Notes
- Formato esperado: sem谩ntico 'X.Y' o 'X.Y.Z' o simple 'X'
- Validar con regex: `/^\d+(\.\d+)*$/`

## Implementaci贸n Sugerida

```typescript
// src/app/api/prompts/[id]/route.ts

// Funci贸n de validaci贸n de versi贸n
function isValidVersion(version: string): boolean {
  return /^\d+(\.\d+)*$/.test(version);
}

// Funci贸n de incremento de versi贸n
function incrementVersion(version: string): string {
  if (!isValidVersion(version)) {
    return '1.0'; // Default para versiones inv谩lidas
  }
  
  const parts = version.split('.');
  const major = parts[0] || '1';
  const minor = parseInt(parts[1] || '0') + 1;
  return `${major}.${minor}`;
}

// En PUT handler, l铆nea ~103:
if (shouldVersion) {
  // Validar versi贸n existente
  if (existingPrompt.version && !isValidVersion(existingPrompt.version)) {
    console.warn(`Invalid version format: ${existingPrompt.version}, resetting to 1.0`);
  }
  
  updateData.version = incrementVersion(existingPrompt.version || '1.0');
}
```

## Log de Cambios
| Fecha | Estado | Notas |
|-------|--------|-------|
| - |  Pending | Creado |
