# WO-0001: Validar ownership en PUT/DELETE de prompts

## Metadatos
| Campo | Valor |
|-------|-------|
| id | WO-0001 |
| title | Validar ownership en PUT/DELETE de prompts |
| type | security |
| priority | P0 |
| area | BE |
| status |  Pending |

## Rationale
Hallazgo HIGH: IDOR en todos los endpoints. Usuario A puede modificar prompts de usuario B sin validaci贸n. Riesgo cr铆tico de seguridad.

## Scope

### Include
- `src/app/api/prompts/[id]/route.ts`

### Exclude
- No modificar GET (es read-only)
- No refactor de arquitectura de auth

## Dependencies
Ninguna

## Acceptance Criteria
- [ ] PUT /api/prompts/[id] retorna 403 si prompt.authorId !== currentUser.id
- [ ] DELETE /api/prompts/[id] retorna 403 si prompt.authorId !== currentUser.id
- [ ] El propietario leg铆timo puede modificar/eliminar sus prompts normalmente

## Definition of Done

### Tests
- TBD: WO-0012 debe existir para tests formales. Por ahora: test manual documentado.

### Security
- [ ] Check de ownership antes de cualquier modificaci贸n

### Observability
- [ ] console.warn con promptId y userId cuando se deniega acceso

### Docs
- N/A - Sin cambio de contrato HTTP (solo comportamiento interno)

### Evidence
- [ ] curl commands mostrando 403 para acceso denegado
- [ ] curl commands mostrando 200 para acceso permitido
- [ ] Diff del cambio

## Verify

### Commands
```bash
# Test acceso denegado (usar ID de prompt ajeno)
curl -X PUT -H "Content-Type: application/json" -d '{"title":"hack"}' http://localhost:3000/api/prompts/<ID_PROMPT_AJENO>

# Lint
bun run lint
```

### Expected
- Primer comando retorna 403 con body `{error: 'No autorizado'}`
- Lint pasa sin errores

## Risk

### Failure Modes
- Bloquear acceso leg铆timo si currentUser es null siempre
- currentUser puede ser null si no hay sesi贸n

### Rollback
```bash
git revert <commit-hash>
```

## Notes
- currentUser se obtiene de llamada a /api/user que retorna el usuario default
- **SOLUCIN TEMPORAL**: Mientras no hay auth real, validar que el prompt existe y confiar en el sistema actual
- El sistema actual usa un usuario default hardcodeado, por lo que la validaci贸n de ownership ser谩: si existe el prompt y el usuario est谩 autenticado (existe usuario default), permitir

## Implementaci贸n Sugerida

```typescript
// En PUT y DELETE, agregar antes de la modificaci贸n:
const currentUser = await db.user.findFirst();

if (!currentUser) {
  return NextResponse.json({ error: 'No autorizado' }, { status: 403 });
}

// Para producci贸n con auth real:
// if (existingPrompt.authorId !== currentUser.id) {
//   return NextResponse.json({ error: 'No autorizado' }, { status: 403 });
// }
```

## Log de Cambios
| Fecha | Estado | Notas |
|-------|--------|-------|
| - |  Pending | Creado |
