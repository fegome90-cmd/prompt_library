# WO-0006: Prevenir XSS en preview de prompts

## Metadatos
| Campo | Valor |
|-------|-------|
| id | WO-0006 |
| title | Prevenir XSS en preview de prompts |
| type | security |
| priority | P1 |
| area | FE |
| status | 游댮 Pending |

## Rationale
Hallazgo MED: XSS potencial. generatedText se renderiza sin sanitizar dentro de `<pre>`. Si prompt.body contiene `<script>`, podr칤a ejecutarse.

## Scope

### Include
- `src/components/prompt-manager/prompt-composer.tsx`

### Exclude
- No modificar otros componentes
- No instalar librer칤as pesadas

## Dependencies
Ninguna

## Acceptance Criteria
- [ ] Prompt con body conteniendo `<script>alert('xss')</script>` no ejecuta el script
- [ ] Preview muestra el texto literal del script, no lo interpreta
- [ ] HTML entities se escapan correctamente

## Definition of Done

### Tests
- [ ] Test manual: crear prompt con XSS, verificar que no ejecuta

### Security
- [ ] XSS mitigado mediante escape o sanitizaci칩n

### Observability
- N/A

### Docs
- [ ] Comentario explicando por qu칠 es seguro

### Evidence
- [ ] Screenshot de preview mostrando script como texto
- [ ] Diff del cambio

## Verify

### Commands
```bash
# Crear prompt con XSS y verificar en preview
# 1. Crear prompt con body: <script>alert(1)</script>
# 2. Abrir composer y verificar que el script aparece como texto

# Lint
bun run lint
```

### Expected
- El script aparece como texto literal, no hay alert
- Lint pasa

## Risk

### Failure Modes
- Escape excesivo rompe formato del prompt
- Caracteres especiales se muestran incorrectamente

### Rollback
```bash
git revert <commit-hash>
```

## Notes
**INVESTIGACI칍N PREVIA REQUERIDA:**

1. Verificar si React ya escapa por defecto en JSX:
   ```jsx
   <pre>{generatedText}</pre>  // React escapa autom치ticamente
   ```
   
2. Verificar si existe `dangerouslySetInnerHTML` en el c칩digo:
   ```bash
   grep -r "dangerouslySetInnerHTML" src/
   ```

3. Si React escapa autom치ticamente, el WO es solo documentaci칩n y verificaci칩n.

4. Si hay `dangerouslySetInnerHTML`, reemplazar por texto escapado.

## Implementaci칩n Sugerida

```typescript
// Si React ya escapa (caso m치s probable):
// Solo agregar comentario documentando la seguridad

// En prompt-composer.tsx, l칤nea ~311:
{/*
  Security: React automatically escapes content in JSX expressions.
  generatedText is rendered as text, not HTML, so XSS is prevented.
  Do NOT use dangerouslySetInnerHTML here.
*/}
<pre className="text-sm whitespace-pre-wrap font-mono">
  {generatedText || 'Completa las variables para ver el prompt...'}
</pre>

// Si se necesita sanitizar (caso con dangerouslySetInnerHTML):
import DOMPurify from 'dompurify';

<pre 
  className="text-sm whitespace-pre-wrap font-mono"
  dangerouslySetInnerHTML={{ 
    __html: DOMPurify.sanitize(generatedText) 
  }}
/>
```

## Log de Cambios
| Fecha | Estado | Notas |
|-------|--------|-------|
| - | 游댮 Pending | Creado |
